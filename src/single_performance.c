#include "pool.h"
#include "profiling.h"
#include <stdbool.h>

CollisionData reference[TEST_CASES];

void setUp(void)
{

    reference[0] = (CollisionData){
        .R = 0.028575,
        .M = 0.170097,
        .u_s1 = 0.2,
        .u_s2 = 0.2,
        .u_b = 0.08734384602561387,
        .e_b = 0.95,
        .N = 1000,
        .rvw1 = {
            0.6992984838308823, 1.6730222005156081, 0.028575,
            0.1698748188477139, -0.1697055263453331, 0.0,
            5.938951053205008, 5.944875550226208, 0.0},
        .rvw2 = {0.7094873834407238, 1.616787789884389, 0.028575, 0.0606759657524449, 0.0319282034361416, 0.0, -1.117347451833478, 2.123393377163425, 0.0},
        .ball1 = {.velocity = {0.12563856764795983, 0.03837893810480299, 0.0}, .angular = {4.439313076347657, 5.673161832134484, -0.5625137907000655}},
        .ball2 = {.velocity = {0.10160950039505853, -0.17583062081979212, 0.0}, .angular = {-2.5884954729422778, 2.1406312388740973, -0.5625137907000655}}};

    reference[1] = (CollisionData){
        .R = 0.028575,
        .M = 0.170097,
        .u_s1 = 0.2,
        .u_s2 = 0.2,
        .u_b = 0.051263960345564547,
        .e_b = 0.95,
        .N = 1000,
        .rvw1 = {
            0.6625385097859544, 1.7115842755232573, 0.028575,
            0.0446139693964031, 0.0828311545852449, 0.0,
            -2.8987280694748887, 1.5612937671532132, 0.0},
        .rvw2 = {0.6388535708475327, 1.763595296295621, 0.028575, 0.4584680433236995, -0.2025096965252413, 0.0, 7.086953509194799, 16.044375969333316, 15.419428906285734},
        .ball1 = {.velocity = {0.23522139367796607, -0.2921400324639589, 0.0}, .angular = {-3.6328276540227558, 1.3688037962335442, -1.7097016805921317}},
        .ball2 = {.velocity = {0.2662732674008842, 0.17238793191918897, 0.0}, .angular = {6.3592894981178825, 15.713010089292721, 13.709727225693594}}};

    reference[2] = (CollisionData){
        .R = 0.028575,
        .M = 0.170097,
        .u_s1 = 0.2,
        .u_s2 = 0.2,
        .u_b = 0.08312916406140705,
        .e_b = 0.95,
        .N = 1000,
        .rvw1 = {
            0.3959469351985615, 0.4161515777741728, 0.028575,
            0.1217519974181435, -0.326307055387703, 0.0,
            11.41931952362915, 4.260787311221119, 23.191742437842027},
        .rvw2 = {0.3463452334341006, 0.3877650704798705, 0.028575, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
        .ball1 = {.velocity = {0.16726244740417917, -0.2949975214713052, 0.0}, .angular = {11.408127004317645, 4.280344772064272, 22.79199711500019}},
        .ball2 = {.velocity = {-0.04546808169752021, -0.0312803252741715, 0.0}, .angular = {-0.008637082546362508, 0.01585069894318658, -0.3997453228418319}}};

    reference[3] = (CollisionData){
        .R = 0.028575,
        .M = 0.170097,
        .u_s1 = 0.2,
        .u_s2 = 0.2,
        .u_b = 0.034911633671085254,
        .e_b = 0.95,
        .N = 1000,
        .rvw1 = {
            0.5302955807259006, 1.6078116068699646, 0.028575,
            0.0, 0.0, 0.0,
            0.0, 0.0, 0.0},
        .rvw2 = {0.5326951841566092, 1.550712005140396, 0.028575, -0.2808347525858405, 0.6822451488164933, 0.0, -23.87559575910738, -9.82798784202416, -22.204439444348584},
        .ball1 = {.velocity = {-0.017305554796558674, 0.6744899058197328, 0.0}, .angular = {1.4640303990030437, 0.06811652077476217, 0.9715947428011615}},
        .ball2 = {.velocity = {-0.2634288078123872, 0.003573833954956038, 0.0}, .angular = {-22.045737797390846, -9.751088296149208, -21.232844701547382}}};

    reference[4] = (CollisionData){
        .R = 0.028575,
        .M = 0.170097,
        .u_s1 = 0.2,
        .u_s2 = 0.2,
        .u_b = 0.01927792191606111,
        .e_b = 0.95,
        .N = 1000,
        .rvw1 = {
            0.7259229146341827, 0.5061287584781619, 0.028575,
            0.0, 0.0, 0.0,
            0.0, 0.0, 0.0},
        .rvw2 = {0.6823057617760474, 0.543056615048102, 0.028575, 2.4511368257402206, 0.6259593056098344, 0.0, -19.324926113047344, 75.67271166973282, 0.0},
        .ball1 = {.velocity = {1.1060149417261151, -0.9059349187641589, 0.0}, .angular = {-0.6741763817472055, -0.7895903199908095, -2.0380303552667263}},
        .ball2 = {.velocity = {1.3428287942353496, 1.5337707065147121, 0.0}, .angular = {-20.163274160647937, 74.68250107163708, -2.0380303552667263}}};
}

void call_function(CollideBallsFn collide_fn)
{

    double rvw1_result[9];
    double rvw2_result[9];

    for (int i = 0; i < TEST_CASES; i++)
    {

        for (int j = 0; j < ITERATIONS; j++)
        {

            collide_fn(
                reference[i].rvw1,
                reference[i].rvw2,
                reference[i].R,
                reference[i].M,
                reference[i].u_s1,
                reference[i].u_s2,
                reference[i].u_b,
                reference[i].e_b,
                0.0f,
                reference[i].N,
                rvw1_result,
                rvw2_result,
                NULL,
                NULL);
        }
    }
}

int main()
{

    setUp();

    call_function(recip_sqrt);

    return 0;
}
